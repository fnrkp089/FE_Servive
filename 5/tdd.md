# ❤ TDD

[TDD - 테스트 주도 개발](https://github.com/ahastudio/til/blob/main/agile/test-driven-development.md)

[Jest TDD Example](https://github.com/ahastudio/til/blob/main/jest/20201204-simple-tdd-example.md)

## 테스트 작성

면접  때,종종 TDD경험이 있냐고 물어본다.\
테스트 코드를 짜는 이유는, 제품 혹은 서비스의 품질을 확인해보거나, 우리가 미처 예상치 못한 이슈를\
찾아 의도한 대로 어플리케이션이 동작하도록 하는것이다.\
\
보통 전 회사에서도 시간이 넉넉치 않아, 설계->코드개발->테스트의 순으로 진행되어\
해당 부분에 대한 경험이 적은것이 아쉽다.



## TDD(Test-Driven Development)

TDD는 테스트를 먼저 작성하고, 그 테스트를 통과하기 위한 코드를 작성하는 방식으로 개발을 진행\
즉 구현보다는 인터페이스와 스펙을 먼저 정의한 뒤 개발을 진행한다.

**TDD Cycle**

1. <mark style="color:red;">Red</mark> → 실패하는 테스트 코드를 작성. 인터페이스와 스펙에 집중한다.
2. <mark style="color:green;">Green</mark> → 재빨리 테스트를 통과시킨다. 올바른 방법이 아니어도 괜찮다.
3. <mark style="color:blue;">Refactor</mark> → 리팩터링을 통해 코드를 올바르게 만든다. TDD에서 가장 중요한 부분이지만, 간과될 때가 많다.

위의 사이클을 최장 10분 이내로 하는것이 좋고, \
작은 단계를 찾고, 코드에서 피드백을 얻는 게 (어렵고) 중요하다. \
2번이 어렵다면 1번으로 돌아가서 더 작고 쉬운 문제를 정의하고, \
3번을 위해 의도를 드러내고 중복을 찾아 제거하는 연습을 해야 한다. \
**이 둘이 익숙하지 않으면 TDD를 하는 게 거의 불가능하고, 사실 이 둘이 어려우면 일반적인 개발 또는 클린 코드를 작성하는 것 또한 매우 힘들다.**

> 연습을 자주 해야한다.

## Jest

Jest는 페이스북에서 만든 단순함에 초점을 맞춘 자바스크립트 테스트 프레임워크.

> NestJs에서 시험삼아 테스트할때 해봣다. 하지만 정확하게 사용했다고 말할수 없을정도

*   describe()

    여러 개의 test()코드를 하나의 테스트 작업 단위로 묶는다.
*   test()

    테스트 코드를 돌리기 위한 API, 하나의 테스트 케이스를 의미하고 it()으로 쓸 수도 있다.
*   expect()

    인자로는 테스트할 대상을 넣고, 기대 값 등을 뒤에 메서드 체이닝으로 넣어준다.
*   beforeEach()

    테스트 파일의 테스트 코드가 돌기 전에 수행할 로직을 넣어준다.\
    테스트 케이스마다 반복되는 로직이 있는 경우 사용하면 유용하다.

## Describe - Context - It 패턴

일반적으로 Jest를 사용하여 테스트코드를 작성할때 위의 패턴을 사용한다.

Describe - Context - It 패턴은 테스트 그룹의 구조를 명확하게 표현할 수 있으며, 테스트 코드를 읽기 쉽고 이해하기 쉽게 만들어준다.

* Describe : 설명할 테스트 대상(클래스나 메소드, 함수명)
* Context : 테스트 대상이 놓인 상황 설명(메소드에 입력할 파라미터, 문장 앞에 when/with 자주 사용)
* it: 테스트 대상의 행동을 설명(메소드의 리턴값 설명)



```javascript
describe("테스트 그룹 이름", () => {
  context("테스트 케이스 그룹 이름", () => {
    it("테스트 케이스 이름", () => {
      // 테스트 코드 작성
    });
  });
});
```

```javascript
describe("Calculator", () => {
  context("addition", () => {
    it("should add two numbers correctly", () => {
      const result = 1 + 2;
      expect(result).toBe(3);
    });
  });
  
  context("subtraction", () => {
    it("should subtract two numbers correctly", () => {
      const result = 3 - 2;
      expect(result).toBe(1);
    });
  });
});
```

위의 코드에서 "Calculator"라는 이름의 Describe 블록을 생성하고, \
"addition"과 "subtraction"이라는 이름의 Context 블록을 생성하여\
&#x20;각각 덧셈과 뺄셈에 대한 테스트 케이스를 작성하였다. \
이를 It 블록 내에서 각각 검증하고 있다.



## 단위 테스트

> 단위 테스트는 응용 프로그램에서 테스트 가능한 가장 작은 소프트웨어를 실행하여 예상대로 동작하는지 확인하는 테스트이다.

단위 테스트는 일반적으로 함수, 메서드, 클래스 수준을 테스트하는 것이다. 어떤 기능이 실행되면 어떤 결과가 나온다 정도로 테스트를 진행한다.

### 단위 테스트 작성의 필요성

단위 테스트는 애플리케이션의 작은 부분만 독립적으로 테스트 하므로 빠르게 문제 여부를 확인할 수 있다.

모든 함수에 대해 단위 테스트를 진행하므로 테스트 코드를 잘 작성하는 것만으로 개발자의 의도를 더욱 명확히 알 수 있다.

단위 테스트는 소프트웨어 개발의 초기 단계에서 작성하는 것이 좋다.

* 버그 발견이 쉬워짐
* 코드의 유지보수가 용이해짐
* 코드의 품질이 향상됨
* 개발 생산성이 높아

### 좋은 테스트란?

> &#x20;**F (Fast) I (Isolated) R (Repeatable), S (Self - Validating), T (Timely)**

좋은 테스트의 FIRST 법칙이 있다.

**Fast**: 실행 속도가 빨라야 한다. 느린 것에 대한 의존성 낮추어야 한다. 예를 들어 파일, 데이터베이스, 네트워크 등 실행 속도를 느려지게 하는 부분에서 mock 함수를 사용하면 좋다

**Isolated** : 독립적이고 집중적으로 유지해야 한다.

**Repeatable** : 코드가 변하지 않았다면 테스트 결과는 항상 동일 해야 한다. 다른 테스트 코드에 의존하거나 네트워크에 의존하면 좋지 않다. 환경에 영향을 받지 않도록 작성하는 것이 좋다.

**Self - Validating** : 스스로 결과를 검증하기

**Timely** : 시기적절하게 테스트 코드 작성하기
